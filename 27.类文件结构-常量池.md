## 类文件结构-常量池

紧接着主次版本号之后的是常量池入口，常量池可以理解为Class文件中的资源仓库，它是Class文件结构中与其他项目关联最多的数据类型，同时它还是在Class文件中第一个出现的表类型数据项目。

常量池中的常量的数量不是固定的，所以在常量池的入口有一项u2类型的数据，代表常量池容量计数值，这个值是从1开始而不是0。第0项常量空出来的目的在于满足后面某些指向常量池的索引值的数据在特定情况下需要表达“不引用任何一个常量池项目”的含义。

常量池中主要存放两大类常量：字面量（Literal）和符号引用（Symbolic References）。字面量比较接近Java语言层面的常量概念，如文本字符串、声明为final的常量值等。而符号引用则属于编译原理方面的概念，包括下面三类常量：

+ 类和接口的全限定名
+ 字段的名称和描述符
+ 方法的名称和描述符

常量池的每一项常量都是一个表，在JDK1.7中共有14种结构不同的表结构数据，这14种表有一个共同的特点，就是在表开始的第一位是一个u1类型的标志位（tag），代表当前这个常量属于哪种常量类型。这14种类型代表的含义如下表：

<table>
    <tr>
        <th>常量</th>
        <th>描述</th>
        <th>结构</th>
        <th>类型</th>
        <th>描述</th>
    </tr>
    <tr>
        <td rowspan="3">CONSTANT_Utf8_info</td>
        <td rowspan="3">UTF-8编码的字符串</td>
        <td>tag</td>
        <td>u1</td>
        <td>值为1</td>
    </tr>
    <tr>
        <td>length</td>
        <td>u2</td>
        <td>UTF-8编码的字符串占用的字节数</td>
    </tr>
    <tr>
        <td>bytes</td>
        <td>u1</td>
        <td>长度为length的UTF-8编码的字符串</td>
    </tr>
    <tr>
        <td rowspan="2">CONSTANT_Integer_info</td>
        <td rowspan="2">整形字面量</td>
        <td>tag</td>
        <td>u1</td>
        <td>值为3</td>
    </tr>
    <tr>
        <td>bytes</td>
        <td>u4</td>
        <td>按照高位在前存储的int值</td>
    </tr>
    <tr>
        <td rowspan="2">CONSTANT_Float_info</td>
        <td rowspan="2">浮点型字面量</td>
        <td>tag</td>
        <td>u1</td>
        <td>值为4</td>
    </tr>
    <tr>
        <td>bytes</td>
        <td>u4</td>
        <td>按照高位在前存储的float值</td>
    </tr>
    <tr>
        <td rowspan="2">CONSTANT_Long_info</td>
        <td rowspan="2">长整形字面量</td>
        <td>tag</td>
        <td>u1</td>
        <td>值为5</td>
    </tr>
    <tr>
        <td>bytes</td>
        <td>u8</td>
        <td>按照高位在前存储的long值</td>
    </tr>
    <tr>
        <td rowspan="2">CONSTANT_Double_info</td>
        <td rowspan="2">双精度浮点型字面量</td>
        <td>tag</td>
        <td>u1</td>
        <td>值为6</td>
    </tr>
    <tr>
        <td>bytes</td>
        <td>u8</td>
        <td>按照高位在前存储的double值</td>
    </tr>
    <tr>
        <td rowspan="2">CONSTANT_Class_info</td>
        <td rowspan="2">类或接口的符号引用</td>
        <td>tag</td>
        <td>u1</td>
        <td>值为7</td>
    </tr>
    <tr>
        <td>index</td>
        <td>u2</td>
        <td>指向全限定常量项的索引</td>
    </tr>
    <tr>
        <td rowspan="2">CONSTANT_String_info</td>
        <td rowspan="2">字符串类型字面量</td>
        <td>tag</td>
        <td>u1</td>
        <td>值为8</td>
    </tr>
    <tr>
        <td>index</td>
        <td>u2</td>
        <td>指向字符串字面量的索引</td>
        </tr>
    <tr>
        <td rowspan="3">CONSTANT_Fieldref_info</td>
        <td rowspan="3">字段的符号引用</td>
        <td>tag</td>
        <td>u1</td>
        <td>值为9</td>
    </tr>
    <tr>
        <td>index</td>
        <td>u2</td>
        <td>指向声明字段的类或接口描述符CONSTANT_Class_info的索引项</td>
    </tr>
    <tr>
        <td>index</td>
        <td>u2</td>
        <td>指向字段描述符CONSTANT_NameAndType_info的索引项</td>
    </tr>
    <tr>
        <td rowspan="3">CONSTANT_Methodref_info</td>
        <td rowspan="3">类中方法的符号引用</td>
        <td>tag</td>
        <td>u1</td>
        <td>值为10</td>
    </tr>
    <tr>
        <td>index</td>
        <td>u2</td>
        <td>指向声明方法的类描述符CONSTANT_Class_info的索引项</td>
    </tr>
    <tr>
        <td>index</td>
        <td>u2</td>
        <td>指向名称及类型描述符CONSTANT_NameAndType_info的索引项</td>
    </tr>
    <tr>
        <td rowspan="3">CONSTANT_InterfaceMethodref_info</td>
        <td rowspan="3">接口中方法的符号引用</td>
        <td>tag</td>
        <td>u1</td>
        <td>值为11</td>
    </tr>
    <tr>
        <td>index</td>
        <td>u2</td>
        <td>指向声明方法的接口描述符CONSTANT_Class_info的索引项</td>
    </tr>
    <tr>
        <td>index</td>
        <td>u2</td>
        <td>指向字段描述符CONSTANT_NameAndType_info的索引项</td>
    </tr>
    <tr>
        <td rowspan="3">CONSTANT_NameAndType_info</td>
        <td rowspan="3">字段或方法的部分符号引用</td>
        <td>tag</td>
        <td>u1</td>
        <td>值为12</td>
    </tr>
    <tr>
        <td>index</td>
        <td>u2</td>
        <td>指向该字段或方法名称常量项的索引</td>
    </tr>
    <tr>
        <td>index</td>
        <td>u2</td>
        <td>指向该字段或方法描述符常量项的索引</td>
    </tr>
    <tr>
        <td rowspan="3">CONSTANT_MethodHandle_info</td>
        <td rowspan="3">表示方法句柄</td>
        <td>tag</td>
        <td>u1</td>
        <td>值为15</td>
    </tr>
    <tr>
        <td>reference_kind</td>
        <td>u1</td>
        <td>值必须在1-9之间（包括1和9），它决定了方法句柄的类型。</td>
    </tr>
    <tr>
        <td>reference_index</td>
        <td>u2</td>
        <td>值必须是对常量池的有效索引</td>
    </tr>
    <tr>
        <td rowspan="2">CONSTANT_MethodType_info</td>
        <td rowspan="2">标识方法类型</td>
        <td>tag</td>
        <td>u1</td>
        <td>值为16</td>
    </tr>
    <tr>
        <td>descriptor_index</td>
        <td>u2</td>
        <td>值必须是对常量池的有效索引，常量池在该索引处必须是CONSTANT_Utf8_info结构</td>
    </tr>
    <tr>
        <td rowspan="3">CONSTANT_InvokeDynamic_info</td>
        <td rowspan="3">表示一个动态方法调用点</td>
        <td>tag</td>
        <td>u1</td>
        <td>值为18</td>
    </tr>
    <tr>
        <td>bootstrap_method_attr_index</td>
        <td>u2</td>
        <td>值必须是对当前Class文件中引导方法表的bootstrap_methods[]数组的有效索引</td>
    </tr>
    <tr>
        <td>name_and_type_index</td>
        <td>u2</td>
        <td>值必须是对常量池的有效索引，常量池在该索引处的项必须是CONSTANT_NameAndType_info结构</td>
    </tr>
</table


